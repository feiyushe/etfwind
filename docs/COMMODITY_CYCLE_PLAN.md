# 商品周期轮动功能 - 实现计划

## 核心理念

**周期传导链**：黄金 → 白银 → 铜 → 石油 → 农产品

| 阶段 | 领涨品种 | 经济含义 | 投资信号 |
|------|---------|---------|---------|
| 1 | 黄金 | 避险/通胀预期 | 风险警示，防御配置 |
| 2 | 白银 | 跟随黄金+工业预期 | 周期启动信号 |
| 3 | 铜 | 工业需求复苏 | 经济复苏确认 |
| 4 | 石油 | 经济活动加速 | 通胀压力上升 |
| 5 | 农产品 | 通胀传导末端 | 周期见顶信号 |

---

## 实现阶段

### Phase 1: 商品数据 API (P0)

**目标**：获取5大商品180天K线数据

**文件**：`workers/src/index.ts`

**新增 API**：`GET /api/commodity-cycle`

**数据源**：
- 黄金：东方财富 `101.GC00Y` (已有)
- 白银：Yahoo Finance `SI=F`
- 铜：Yahoo Finance `HG=F`
- 原油：Yahoo Finance `CL=F`
- 玉米：Yahoo Finance `ZC=F`

**返回结构**：
```json
{
  "commodities": {
    "gold": { "name": "黄金", "price": 2850, "kline": [], "change_5d": 3.2, "change_20d": 8.5 },
    "silver": { "name": "白银", "price": 32.5, "kline": [], "change_5d": 5.1, "change_20d": 12.3 },
    "copper": { "name": "铜", "price": 4.85, "kline": [], "change_5d": 2.8, "change_20d": 6.7 },
    "oil": { "name": "原油", "price": 78.5, "kline": [], "change_5d": 1.2, "change_20d": 4.3 },
    "corn": { "name": "玉米", "price": 485, "kline": [], "change_5d": 0.5, "change_20d": 2.1 }
  },
  "cycle": {
    "stage": 1,
    "leader": "gold",
    "description": "黄金领涨期"
  }
}
```

---

### Phase 2: 首页周期指示器 (P0)

**目标**：在首页显示周期进度条

**文件**：
- `workers/src/pages/Home.ts`
- `workers/src/pages/styles.ts`

**UI 设计**：
```
┌─────────────────────────────────────────────┐
│ [黄金●] → [白银○] → [铜○] → [石油○] → [农产品○] │
│ 当前：黄金领涨期 | 下一站：白银               │
└─────────────────────────────────────────────┘
```

**交互**：
- 当前阶段高亮显示
- 显示各品种5日涨幅
- 点击可跳转到 /cycle 详情页

---

### Phase 3: AI 周期分析 (P1)

**目标**：让 AI 分析商品周期位置

**文件**：`src/analyzers/realtime.py`

**扩展 prompt**：
```python
COMMODITY_CYCLE_PROMPT = """
基于"黄金→白银→铜→石油→农产品"传导规律分析：

商品新闻：{commodity_news}

输出：
{
  "cycle": {
    "stage": 1-5,
    "stage_name": "黄金领涨期",
    "confidence": 0.8,
    "analysis": "周期分析（50字）",
    "next_signal": "关注白银ETF"
  }
}
"""
```

**商品新闻过滤关键词**：
- 黄金：黄金、金价、Gold、避险
- 白银：白银、银价、Silver
- 铜：铜、铜价、Copper、LME铜
- 石油：原油、油价、WTI、布伦特、OPEC
- 农产品：玉米、小麦、大豆、农产品、粮食

---

### Phase 4: 历史数据扩展 (P1)

**目标**：在 FOTH Matrix 中记录周期历史

**文件**：`src/worker_simple.py`

**扩展归档结构**：
```json
{
  "foth": {
    "commodity_cycle": {
      "stage": 1,
      "leader": "gold",
      "prices": {
        "gold": 2850,
        "silver": 32.5,
        "copper": 4.85,
        "oil": 78.5,
        "corn": 485
      }
    }
  }
}
```

**历史对比**：加载30天周期历史，分析趋势演变

---

### Phase 5: 独立周期页面 (P2)

**目标**：创建 /cycle 详情页

**文件**：新增 `workers/src/pages/Cycle.ts`

**页面结构**：
```
┌─────────────────────────────────────────────┐
│  商品周期轮动                                │
├─────────────────────────────────────────────┤
│  周期进度条                                  │
├─────────────────────────────────────────────┤
│  5大商品180天走势图（叠加对比）               │
├─────────────────────────────────────────────┤
│  AI 周期分析                                 │
├─────────────────────────────────────────────┤
│  相关 ETF 推荐                               │
│  黄金ETF | 白银LOF | 有色ETF                 │
└─────────────────────────────────────────────┘
```

---

## 相关 ETF 映射

| 商品 | ETF代码 | ETF名称 |
|------|--------|--------|
| 黄金 | 518880 | 黄金ETF |
| 黄金 | 159934 | 黄金ETF |
| 白银 | 161226 | 白银LOF |
| 铜/有色 | 512400 | 有色金属ETF |
| 石油 | 561360 | 石油ETF |
| 农产品 | 159985 | 豆粕ETF |

---

## 任务清单

- [x] Phase 1: 商品数据 API ✅ 2026-01-29
  - [x] 添加 Yahoo Finance 白银/铜/油/玉米数据源
  - [x] 创建 /api/commodity-cycle 端点
  - [x] 计算周期阶段逻辑

- [x] Phase 2: 首页周期指示器 ✅ 2026-01-29
  - [x] 添加周期进度条 UI
  - [x] 客户端 JS 加载数据
  - [x] 移动端适配

- [x] Phase 3: AI 周期分析 ✅ 2026-01-29
  - [x] 扩展 ANALYSIS_PROMPT
  - [x] 输出 cycle 字段

- [x] Phase 4: 历史数据扩展 ✅ 2026-01-29
  - [x] 扩展 FOTH Matrix
  - [x] 周期历史上下文

- [x] Phase 5: 独立周期页面 ✅ 2026-01-29
  - [x] 创建 /cycle 路由
  - [x] 走势叠加图
  - [x] ETF 推荐卡片

---

## 数据流

```
GitHub Actions (每小时)
  │
  ├─ 采集新闻 → 过滤商品新闻
  │
  ├─ AI分析
  │   ├─ 市场分析 (现有)
  │   └─ 周期分析 (新增) → cycle 字段
  │
  └─ 上传 R2 → latest.json
           ↓
Cloudflare Workers
  │
  ├─ /api/commodity-cycle (实时商品价格)
  │
  ├─ / 首页 (周期指示器)
  │
  └─ /cycle 周期页面 (详情)
```

---

## 创建时间

2026-01-29
